---
title: “操作系统.md”
date: 2021-07-31 12:00:13
tags:
---

# 操作系统

### 面试必考

- Linux指令、中断、多线程、并发、性能、内存管理、系统稳定性、文件系统、容器和虚拟化
- 搜索知识和梳理知识

# 前置知识

### 一、计算机组成原理

### 1、计算问题

- 芯片：电+脉冲信号----》脉冲----〉谐震效益放大---》形成驱动芯片的时钟频率
- 时钟周期：每一次时钟信号高低电平的转换为一个周期，如1GHz。
- 不完备性定理：永远存在无法证明和无法证伪的问题；无法用几个定理概括一切
- 可计算理论：永远存在无法计算的问题
- 停机问题：执行了10年的程序会不会停机
- P问题（多项式问题）、NP问题：P问题可通过计算解决，NP问题不一定能通过计算解决，如（2^n）问题
- 人工智能：基于概率的不完全解法，让机器的解法超过人类

### 2、程序的执行 - 硬件

- 图灵机：定义了计算机能力的边界、定义了计算机由什么组成（包括纸带、读写头、控制单元、运算单元）
- 冯诺依曼模型：1、输入设备。2、输出设备。3、内存。4、中央处理器。5、总线
- CPU：每一次计算4个字节，称为32位CPU，8个字节称为64位CPU。包括控制单元、逻辑运算单元、寄存器
- 寄存器：通用寄存器（可供用户编程用）、特殊寄存器（PC）、指令寄存器（下一行要执行的指令）
- 总线：地址总线、数据总线、控制总线。线路位宽，地址总线有32条，一次就可以操作4g的内存。
- 32位和64位CPU：
  - 一、32位一次计算4个字节（20亿），64位一次计算8个字节，64位更快，32位也够用
  - 二、32位地址总线最多32条，2的32次方（42亿）限制内存最多4G。64位，理论最大16T

### 3、程序的执行 - 软件

- 程序的执行过程：
  - 程序被编译器编译成数据和指令两个部分，分开存入内存
  - CPU读取PC指针指向的指令，通过地址总线导入到指令寄存器
  - 根据指令（load）将数据导入到不同的寄存器
  - 计算类型指令交由逻辑运算单元，存储类型交由控制单元。
  - PC指针自增（32位机器，指令占32位4个字节，PC自增4）
- 指令周期：
  - fetch：获取
  - decode：解码
  - execution：执行
  - store：结果存回内存
- 指令的执行速度：
  - 一条指令需要2到6个时钟周期
- 64位和32位程序：
  - 32位指令可以在64位机器上运行，64位指令的参数无法存在32位的机器

### 4、构造复杂程序

- 常见的芯片指令集：Intel和AMD的 CISC指令集，ARM的RISC

- **程序的指令实现：**
  - 循环：使用**jump**指令直接操作PC指针，重新回到loop开始。一般在jump Loop之后会加+nop，让cpu空转一个周期，避免下面指令被抢先执行
  - 条件控制程序：if-else是自上向下的逻辑。switch-case是一种精确匹配算法。
  - 方法：定义方法名做标签，使用栈保存方法的参数和要执行的指令，调用时jump到方法标签处
  - 递归：使用栈保存+stack pointer栈指针
  - 类型class：构造方法执行时进行扫描，分成属性（分配内存地址）、方法两个部分；this则为栈的第一个参数
  - 总结：变量是内存地址，分配地址就行。循环、条件控制可以通过跳转加判断实现。函数调用压栈、返回值和返回地址

### 5、存储器的分级

- 存储器速度越快，能耗通常越高，发热量越大。根据数据的使用频率选择不同的存储器

- 分级：

  - 寄存器，4到8个字节，半个CPU周期可以完成读写

  - L1 Cache，几十到几百kb不等，2-4个CPU周期

  - L2 Cache，2M，10-20个周期

  - L3 Cache，20-60个周期，比如i9，512k L1，2M L2 ，16 M L3

  - 内存，200到300个周期 。L1比内存快100倍左右，内存读写比SSD快10-1000倍，则L1比SSD快1000-10000倍

- 缓存条目结构：类似于键值对，采用哈希表的形式进行查找
- 缓存命中率：指令会进行预读，L1分为指令和数据区域，命中率约80%，L1/L2/L3加起来约有95%



### 二、Linux入门

### 1、目录结构和文件管理指令

- Bourne Again Shell = bash
- 一切皆文件。七种类型：普通文件、目录文件/、可执行文件*、管道文件｜、Socket文件=、软连接文件@、硬连接文件
- touch  修改文件时间戳，当文件不存在时创建
- man    man （manual man） 查看指令的说明书
- rm       -r （recursive）递归删除
- ls         -l 查看文件夹更详细资料
- mkdir  - p hello/world   强制创建路径需要的文件夹
- cat      /etc/hosts     快速查看整个文件，如配置文件
- more   读取部分文件，如 日志文件  （+ / + 字符 可以进行查询）
- less      同more，可以向上翻页
- tail/head  -n 100    前100或后100的文件
- grep 80.82.207.86 ./nginx_logs.txt. 查看保护给ip的文件
- rm -rfi 删除前进行确认
- find / -iname *.txt   忽略大小写查找所有.txt的文件

### 2、进程、管道指令

- 进程定义：应用执行的副本 。作用：操作系统分配资源的最小单位
  - ps  process snapshot 只显示同一个TTY上的进程
  - ps -ef 显示所有进程（UID进程所有者、PID进程唯一标识、PPID进程的父进程、C=CPU利用率）
  - ps aux 显示所有进程 显示的风格不一样
  - top 实时显示进程数据

- 重定向：

  - ls -l > out  将结果重定向输出到out文件
  - ls -l >> out  将结果追加到out文件

- 管道：命令之间传递数据，连接两个输入输出流

  - ls | sort -r  将文件名输出 + 管道 +倒序排序+输出         排序

  - sort a.txt | uniq  排序文件 + 找到相邻重复行，然后去重          去重

  - find ./ | grep Spring  查找项目文件下文件名包含Spring的文件    筛选

  - find  ./ | grep Spring | grep -v MyBatis 找到spring但不用mybatis

  - wc -l xxxx.java 数数文件有多少行

  - ls | wc -l  数数有多少文件

  - Tee xxx  连接管道之间，将结果保存

  - ls｜ xargs -I GG echo "mv GG prefix_GG"   xargs 从输入流获取字符串，切割字符串构造指令

  - ```bash
    GgdeMacBook-Air:syn ggguang$ ls | xargs -I GG echo "mv GG pro_GG"
    mv UnSafeBank.java pro_UnSafeBank.java
    mv UnsafeBuyTicket.java pro_UnsafeBuyTicket.java
    mv a.txt pro_a.txt
    mv b.txt pro_b.txt
    mv c.txt pro_c.txt
    ```

  - xargs 的作用：

    - 将输入的字符串分割成一条条子串，再按照自己的想法构建成新的指令
    - 如：修改文件名、逐条ping Ip地址

### 3、用户和权限划分原则

- 用户与组：Linux多用户平台，允许多个用户同时登陆，于是将用户抽象成账户。组账户方便分配权限。

- Root账户：超级管理员。

- 文件权限：

  - 从三个维度进行区分，所属用户权限、组权限、所有用户的权限。
  - ls -l 查看，第一个符号 - 代表普通文件，d 代表目录，p 代表管道

- 思考题

  - 文件如何初始化权限。默认属于创建用户，Linux会为每一个用户创建一个同名分组。默认为 rw-rw-r--
  - 公共执行文件的权限。如ls的权限（which ls 查看命令位置）。不可读即不可执行。

- 权限架构思想

  - 遵循最小权限原则。
  - 权限划分边界清晰。
  - Root权限相互制约

- 用户查看

  - ```bash
    groups  //查看当前用户分组
    id //查看当前用户
    
    cat /etc/passwd //查看所有用户
    
    sudo useradd foo  //新建foo用户
    sudo groupadd foo  //新建分组
    sudo usermod -a -G sudo foo //给foo赋予sudo的权限
    ```

- 文件权限

  - ```bash
    chmod g+x,o+x-w startup.sh //赋给g o 执行和o减去写的权限
    
    chmod 777 1.txt //建文件全开放
    1 表示可执行，2 表示可写，4 表示可读
    ```

### 三、操作系统基础知识

### 1、内核

- 内核Kernal。操作系统中连接应用软硬件的桥梁。
  - 基本功能。至少包括管理进程、线程、内存、连接硬件设备、提高系统调用。
  - 进程与内核的关系类似于 客户端与服务端的关系。
  - 内核的执行不会独占cpu资源。进程向内核发送请求，然后将cpu执行权让给内核。

- 宏内核与微内核
  - 将驱动程序、文件系统都加入到内核中来，成为一个可独立执行的程序
  - 宏内核将驱动程序需要频繁调用底层能力放进内核执行，效率会高
  - 微内核体积更小、可移值性强
  - 混合型内核。宏内核里再抽象出一个微内核。
- windows设计
  - 早起Windows 9X，现在Windows NT。属于混合类型内核
  - 与Linux的区别。Linux是宏内核、NT为混合。可执行文件格式不同。虚拟化技术不同。
  - 可执行文件为PE（.exe .dll .sys），Linux为ELF

### 2、用户态线程和内核态线程

- 用户态和内核态
  - 内存分为内核空间和用户空间，用户空间的代码只能使用局部的内存空间，内核空间都可以使用。
- 进程和线程
  - 一个应用程序启动后会在内存中创建一个执行副本，就是进程。宏内核就会被导入内存成为副本，成为内核进程。
  - 操作系统的执行是以轻量级的进程为单位执行的，就是线程。
- 用户态线程
  - 内核并不知道用户级线程的存在，由用户空间自己决定
  - 优点：管理开销小、切换成本低
  - 缺点：
    - 与内核协作成本高、线程间协作成本高。I/O操作时，需要频繁切换用户态、内核态
    - 无法利用多核优势。进程只能执行一个线程。
    - 无法针对线程调度进行优化。
- 内核态线程
  - 优点：多核优势、操作系统级别的优化。
  - 缺点：创建成本高、扩展性差、切换成本高
- 用户态和内核态线程之间的关系
  - 多对一、一对一、多对多、两层设计

### 3、中断和中断向量

- 探索式学习
- 探索如何设计响应键盘的整个链路
  - 键盘层面：将按下不同按键的电学信号转化为对应的数字信号，组合键结合了时间进行判断
  - CPU层面：CPU收到信号后，会中断当前执行的程序，将PC指针跳转到特点的位置，称为一次中断
    - 提供API给应用程序，让应用程序可以监听操作系统处理后的信息
- 中断：
  - 将不同类型的中断进行分类，叫做**中断识别码**
  - 中断识别码对应PC指针要跳转到的地址，叫做**中断向量**，也形成了中断向量表
  - 类型
    - 同步中断和异步中断
      - 同步中断：CPU指令直接触发的中断。用户态和内核态的切换的中断，称为trap(陷阱); 出现异常
      - 异步中断：响应外部通知的中断，键盘鼠标等
    - 可屏蔽中断和不可屏蔽中断

# 核心知识

### 四、进程和线程

### 五、内存管理

### 六、文件系统

### 七、网络与安全

### 八、虚拟化和其他



 